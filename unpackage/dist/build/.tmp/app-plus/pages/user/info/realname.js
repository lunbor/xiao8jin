(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/info/realname"],{2512:function(t,e,a){"use strict";a("a8bc");var s=n(a("b0ce")),i=n(a("3c45"));function n(t){return t&&t.__esModule?t:{default:t}}Page((0,s.default)(i.default))},"3c45":function(t,e,a){"use strict";a.r(e);var s=a("7969"),i=a("9636");for(var n in i)"default"!==n&&function(t){a.d(e,t,function(){return i[t]})}(n);a("d38b");var r=a("2877"),c=Object(r["a"])(i["default"],s["a"],s["b"],!1,null,null,null);e["default"]=c.exports},7969:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",[a("view",{directives:[{name:"show",rawName:"v-show",value:t.progress>0,expression:"progress>0"}],staticClass:"top-jd"},[a("progress",{attrs:{percent:t.progress}})],1),a("view",{staticStyle:{overflow:"scroll",height:"0rpx",width:"100%"}},[a("canvas",{staticClass:"canvas-element",style:{width:t.cwidth,height:t.cheight},attrs:{"canvas-id":"canvas"}})]),a("view",{directives:[{name:"show",rawName:"v-show",value:1===t.cardInfo.is_validate,expression:"cardInfo.is_validate===1"}]},[a("view",{staticClass:"realname-yes"},[t._m(0),a("view",{staticClass:"uni-list-cell-navigate bt-color"},[t._v("姓名"),a("text",{staticClass:"uni-list-cell-left by-sdh"},[t._v(t._s(t.cardInfo.realname))])]),a("view",{staticClass:"uni-list-cell-navigate bt-color"},[t._v("身份证号"),a("text",{staticClass:"uni-list-cell-left by-sdh"},[t._v(t._s(t.cardInfo.card))])])])]),a("view",{directives:[{name:"show",rawName:"v-show",value:0===t.cardInfo.is_validate,expression:"cardInfo.is_validate===0"}]},[a("view",{staticClass:"card_img_bg",staticStyle:{display:"none"}},[a("view",{staticClass:"card_tip"},[t._v("请上传本人有效期内的身份证照片，享受更多权益")]),a("view",{staticClass:"uni-flex uni-row",staticStyle:{"justify-content":"center"}},[t._m(1),a("view",{staticClass:"text flex-w20"}),a("view",{staticClass:"text card_img",attrs:{eventid:"f5d42436-0"},on:{click:t.chooseImage}},[a("image",{attrs:{src:t.cardInfo.card_img_a?t.cardInfo.card_img_a:"../../../static/card_a.png"}})])]),a("view",{staticClass:"uni-flex uni-row",staticStyle:{"justify-content":"center"}},[t._m(2),a("view",{staticClass:"text flex-w20"}),a("view",{staticClass:"text card_img",attrs:{eventid:"f5d42436-1"},on:{click:t.chooseImageB}},[a("image",{attrs:{src:t.cardInfo.card_img_b?t.cardInfo.card_img_b:"../../../static/card_b.png"}})])])]),a("view",{staticClass:"uni-padding-wrap"},[a("view",{staticClass:"uni-card by-card"},[a("view",{staticClass:"uni-card-content"},[a("view",{staticClass:"uni-form-item uni-column by-border-bottom"},[a("view",{staticClass:"with-fun"},[t._m(3),a("input",{directives:[{name:"model",rawName:"v-model",value:t.cardInfo.realname,expression:"cardInfo.realname"}],staticClass:"uni-input",attrs:{maxlength:"20",placeholder:"",eventid:"f5d42436-2"},domProps:{value:t.cardInfo.realname},on:{input:function(e){e.target.composing||(t.cardInfo.realname=e.target.value)}}})])]),a("view",{staticClass:"uni-form-item uni-column"},[a("view",{staticClass:"with-fun"},[t._m(4),a("input",{directives:[{name:"model",rawName:"v-model",value:t.cardInfo.card,expression:"cardInfo.card"}],staticClass:"uni-input",attrs:{type:"idcard",placeholder:"",eventid:"f5d42436-3"},domProps:{value:t.cardInfo.card},on:{input:function(e){e.target.composing||(t.cardInfo.card=e.target.value)}}})])])])]),a("view",{staticClass:"by-mt-30 by-mb-30"},[a("button",{staticClass:"by-button-submit",attrs:{type:"warn",disabled:1===t.cardInfo.is_validate,loading:t.loading,eventid:"f5d42436-4"},on:{click:t.addIdCard}},[t._v("提交认证")])],1)])])])},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"yes-img"},[a("image",{attrs:{src:"../../../static/realname-yes.png"}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"text card_img"},[a("image",{attrs:{src:"../../../static/card_a_sl.png"}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"text card_img"},[a("image",{attrs:{src:"../../../static/card_b_sl.png"}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"by-sdhf"},[t._v("真实姓名"),a("text")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"by-sdhf"},[t._v("身份证号"),a("text")])}];a.d(e,"a",function(){return s}),a.d(e,"b",function(){return i})},9636:function(t,e,a){"use strict";a.r(e);var s=a("dfa8"),i=a.n(s);for(var n in s)"default"!==n&&function(t){a.d(e,t,function(){return s[t]})}(n);e["default"]=i.a},d38b:function(t,e,a){"use strict";var s=a("d55f"),i=a.n(s);i.a},d55f:function(t,e,a){},dfa8:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(a("a34a"));function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e,a,s,i,n,r){try{var c=t[n](r),o=c.value}catch(d){return void a(d)}c.done?e(o):Promise.resolve(o).then(s,i)}function r(t){return function(){var e=this,a=arguments;return new Promise(function(s,i){var r=t.apply(e,a);function c(t){n(r,s,i,c,o,"next",t)}function o(t){n(r,s,i,c,o,"throw",t)}c(void 0)})}}var c=null,o={data:function(){return{cardInfo:{realname:"",is_validate:"",card:"",card_img_a:"../../../static/card_a.png",card_img_b:"../../../static/card_b.png"},loading:!1,card_a:[],card_b:[],card_a_data:"",card_b_data:"",progress:0,cwidth:"1000px",cheight:"1000px"}},onReady:function(){c=t.createCanvasContext("canvas")},onLoad:function(){this.getIdCard()},onShow:function(){},methods:{getIdCard:function(){var e=this,a=this.$store.state.openid,s=this.$store.state.sessionKey;try{this.$http.post(this.websiteUrl+"/api/api/getIdCard",{openid:a,sessionKey:s},function(a){1==a.data.code?(e.cardInfo=a.data.result.cardInfo,null==e.cardInfo.card&&(e.cardInfo.card=""),null==e.cardInfo.realname&&(e.cardInfo.realname="")):t.showModal({content:a.data.msg,showCancel:!1})})}catch(i){t.showModal({content:"网络异常,请稍后重试...",showCancel:!1})}},addIdCard:function(){var e=this.$store.state.openid,a=this.$store.state.sessionKey,s=this.cardInfo.realname,i=this.cardInfo.card;if(""!=s)if(""!=i){var n=this;try{if(this.loading)return;this.loading=!0,this.$http.post(this.websiteUrl+"/api/api/addIdCard",{openid:e,sessionKey:a,realname:s,card:i},function(e){t.showModal({content:e.data.msg,showCancel:!1,success:function(){n.loading=!1,t.redirectTo({url:"/pages/user/info/realname"})}})})}catch(r){t.showModal({content:"网络异常,请稍后重试...",showCancel:!1,success:function(){n.loading=!1}})}}else t.showModal({content:"请填写身份证号码",showCancel:!1});else t.showModal({content:"请填写真实姓名",showCancel:!1})},upFile:function(e,a){var s=this,i=this.$store.state.openid,n=this.$store.state.sessionKey,r=t.uploadFile({url:this.websiteUrl+"/api/upload/uploadcard",filePath:e,name:"file",formData:{data:JSON.stringify({openid:i,sessionKey:n,side:a})},success:function(e){var i=JSON.parse(e.data);t.hideLoading(),1==i.code?"front"==a?1==i.result.juhe?0==i.result.juhedata.error_code?(s.card_a_data=i.result.img_url,s.cardInfo.realname=i.result.juhedata.result.realname,s.cardInfo.card=i.result.juhedata.result.idcard,t.showToast({title:"成功"})):t.showModal({content:i.result.juhedata.reason,showCancel:!1}):(s.card_a_data=i.result.img_url,t.showToast({title:"成功"})):1==i.result.juhe?0==i.result.juhedata.error_code?(s.card_b_data=i.result.img_url,t.showToast({title:"成功"})):t.showModal({content:i.result.juhedata.reason,showCancel:!1}):(s.card_b_data=i.result.img_url,t.showToast({title:"成功"})):t.showToast({title:i.msg})},fail:function(e){console.log(e),t.hideLoading(),t.showToast({title:"上传失败"})},complete:function(t){s.progress=0}});r.onProgressUpdate(function(t){s.progress=t.progress})},resethb:function(){},chooseImage:function(){var e=r(s.default.mark(function e(){var a,i=this;return s.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=this,a.progress=0,t.chooseImage({sizeType:["compressed"],sourceType:["camera"],count:1,success:function(e){i.card_a=[],i.card_a=i.card_a.concat(e.tempFilePaths);var s=i.card_a.length;if(s>=1){i.cardInfo.card_img_a=i.card_a[s-1];var n=e.tempFilePaths,r="front";t.showLoading({title:"识别中..."});try{return void t.getImageInfo({src:n[s-1],success:function(e){a.resethb(),e.width>1e3?(a.cwidth=e.width/7+"px",a.cheight=e.height/7+"px",c.drawImage(n[s-1],0,0,e.width/7,e.height/7),c.draw(!1,function(){t.canvasToTempFilePath({canvasId:"canvas",success:function(t){a.upFile(t.tempFilePath,r)},fail:function(e){console.error(JSON.stringify(e)),t.hideLoading(),t.showToast({title:"图片压缩失败"})}})})):a.upFile(n[s-1],r)}})}catch(o){t.hideLoading()}}else t.showToast({title:"没有选中图片"})}});case 3:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}(),chooseImageB:function(){var e=r(s.default.mark(function e(){var a,i=this;return s.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=this,this.$store.state.openid,this.$store.state.sessionKey,a.progress=0,t.chooseImage({sizeType:["compressed"],sourceType:["camera"],count:1,success:function(e){i.card_b=[],i.card_b=i.card_b.concat(e.tempFilePaths);var s=i.card_b.length;if(s>=1){i.cardInfo.card_img_b=i.card_b[s-1];var n=e.tempFilePaths,r="back";t.showLoading({title:"识别中..."});try{return void t.getImageInfo({src:n[s-1],success:function(e){a.resethb(),e.width>1e3?(a.cwidth=e.width/7+"px",a.cheight=e.height/7+"px",c.drawImage(n[s-1],0,0,e.width/7,e.height/7),c.draw(!1,function(){t.canvasToTempFilePath({canvasId:"canvas",success:function(t){a.upFile(t.tempFilePath,r)},fail:function(e){console.error(JSON.stringify(e)),t.hideLoading(),t.showToast({title:"图片压缩失败"})}})})):a.upFile(n[s-1],r)}})}catch(o){t.hideLoading()}}else t.showToast({title:"没有选中图片"})}});case 5:case"end":return e.stop()}},e,this)}));function a(){return e.apply(this,arguments)}return a}()}};e.default=o}).call(this,a("649d")["default"])}},[["2512","common/runtime","common/vendor"]]]);